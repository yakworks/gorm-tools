apply plugin:"groovy"
//apply plugin:"war"
apply plugin:"org.grails.grails-web"
// apply plugin:"org.grails.plugins.views-json"


dependencies {
  console "org.grails:grails-console"
  profile "org.grails.profiles:rest-api"

  implementation "org.grails:grails-plugin-url-mappings"
  implementation "org.grails:grails-plugin-rest"
  implementation "org.grails:grails-plugin-codecs"
  implementation "org.grails:grails-plugin-interceptors"

  implementation project(":testify")
  implementation project(":gorm-tools-rest")

  // compile vs implementation required for json views in gradle5/grails4
  compile project(":gorm-tools") //compileGsonViews fails without this
  // compile ("org.grails.plugins:views-json:$vViews")
  // compile "org.grails.plugins:views-json-templates:$vViews"

  // compile "org.slf4j:slf4j-simple:1.7.30"
  // compile "org.slf4j:slf4j-api:1.7.30"
  // compile "org.slf4j:slf4j-nop:1.7.30"

  // REST security dependencies
  implementation "org.grails.plugins:spring-security-rest:$vSpringSecurityRest"
  // compile "org.grails.plugins:spring-security-rest-grailscache:$vSpringSecurityRest"
  implementation "org.grails.plugins:spring-security-rest-gorm:$vSpringSecurityRest"

  // dk.glasius not working, load twice
  // runtimeOnly "dk.glasius:external-config:$vExternalConfig"
  runtime "org.grails.plugins:external-config:$vExternalConfig"
  runtimeOnly "com.h2database:h2"
  runtimeOnly "javax.xml.bind:jaxb-api:2.3.1"
  runtimeOnly "com.zaxxer:HikariCP:$vHikari"

  //for rest api testing
  testCompile "com.squareup.okhttp3:okhttp:$vOkhttp"
  //okhttp3 needs this
  testCompile "org.jetbrains.kotlin:kotlin-stdlib:$vKotlin"
}

bootRun {
  //  ignoreExitValue true
  jvmArgs('-Dspring.output.ansi.enabled=always', '-noverify', '-XX:TieredStopAtLevel=1', '-Xmx1024m')
  sourceResources sourceSets.main
  String springProfilesActive = 'spring.profiles.active'
  systemProperty springProfilesActive, System.getProperty(springProfilesActive)
}

bootJar.enabled = true
//bootJar.archiveFileName = 'restify-api.jar'
