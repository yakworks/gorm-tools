apply plugin:'yakworks.grails-web'

apply from: "${rootDir}/gradle/compile.gradle"
apply from: "${rootDir}/gradle/hibernate.gradle"
apply from: "${rootDir}/gradle/test-unit.gradle"
apply from: "${rootDir}/gradle/test-integration.gradle"

dependencies {
  console "org.grails:grails-console"
  profile "org.grails.profiles:rest-api"

  // implementation "org.springframework.boot:spring-boot-starter-logging"
  // implementation "org.springframework.boot:spring-boot-starter-validation"
  implementation "org.springframework.boot:spring-boot-autoconfigure"
  implementation "org.springframework.boot:spring-boot-starter-actuator"
  implementation "org.springframework.boot:spring-boot-starter-tomcat"

  implementation "org.grails:grails-core"
  implementation "org.grails:grails-web-boot"
  implementation "org.grails:grails-logging"
  implementation "org.grails:grails-plugin-rest"
  // implementation "org.grails:grails-plugin-databinding"
  // implementation "org.grails:grails-plugin-i18n"
  // implementation "org.grails:grails-plugin-services"
  implementation "org.grails:grails-plugin-url-mappings"
  // implementation "org.grails:grails-plugin-interceptors"
  // implementation "org.grails.plugins:cache"
  // implementation "org.grails.plugins:async"
  // implementation "org.grails.plugins:scaffolding"
  // implementation "org.grails.plugins:events"

  implementation project(":testify")
  implementation project(":gorm-rest")

  runtimeOnly "com.h2database:h2:$vH2"
  runtimeOnly "com.zaxxer:HikariCP:$vHikari"
  runtimeOnly "org.glassfish.web:el-impl:2.2.1-b05"
  runtimeOnly "javax.xml.bind:jaxb-api:2.3.1"

  //for rest api testing
  testImplementation "com.squareup.okhttp3:okhttp:$vOkhttp"
  //okhttp3 needs this
  //testImplementation "org.jetbrains.kotlin:kotlin-stdlib:$vKotlin"
  testImplementation project(":gorm-test-support") //this might seem circular but it can be added to itself as it dif config
  testImplementation "org.grails:grails-web-testing-support:$vGrailsTesting"

}

bootRun {
  //  ignoreExitValue true
  jvmArgs('-Dspring.output.ansi.enabled=always', '-noverify', '-XX:TieredStopAtLevel=1', '-Xmx1024m')
  sourceResources sourceSets.main
  String springProfilesActive = 'spring.profiles.active'
  String profileVal = System.getProperty(springProfilesActive) //?: 'dev'
  systemProperty springProfilesActive, profileVal
  systemProperty "project.rootProjectDir", rootProject.projectDir.absolutePath
  systemProperty "project.projectDir", project.projectDir.absolutePath
}

bootJar {
  enabled = true
  archiveFileName = 'rcm-jobs.jar'
  duplicatesStrategy(DuplicatesStrategy.EXCLUDE)
}
