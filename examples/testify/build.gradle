apply plugin:"groovy"
apply plugin: 'java-library'
apply plugin:"org.grails.grails-plugin"

//none of these add dependencies, just configuration, all deps should be below
apply from: "${rootDir}/gradle/compile.gradle"
apply from: "${rootDir}/gradle/hibernate.gradle"
//apply from: "${rootDir}/gradle/example.gradle"
apply from: "${rootDir}/gradle/test-unit.gradle"
apply from: "${rootDir}/gradle/test-integration.gradle"

dependencies {

  // implementation "org.springframework.boot:spring-boot-starter-logging"
  implementation "org.springframework.boot:spring-boot-starter-web:$springBootVersion"
  implementation "org.springframework.boot:spring-boot-starter-oauth2-resource-server"

  api project(":rally-domain")
  api project(":gorm-test-domain")
  // api "org.yakworks:grails-kit:$vSpringGrailsKit"

  // runtime "org.glassfish.web:el-impl:2.1.2-b03"
  // runtimeOnly "javax.xml.bind:jaxb-api:2.3.1"
  // runtimeOnly "com.zaxxer:HikariCP:$vHikari"

  // tests deps
  testRuntimeOnly "com.h2database:h2:$vH2"
  testRuntimeOnly "com.zaxxer:HikariCP:$vHikari"
  testRuntimeOnly "org.grails:grails-web-testing-support:$vGrailsTesting"

  testImplementation project(":gorm-test-support")
  testRuntimeOnly "org.springframework.boot:spring-boot-autoconfigure"
  testRuntimeOnly "org.springframework.boot:spring-boot-starter-tomcat"

  testImplementation "org.springframework.boot:spring-boot-starter-test:$springBootVersion"
  testImplementation "org.springframework.security:spring-security-test:$springSecurityVersion"
}

bootRun {
  ignoreExitValue true
  jvmArgs(
    '-Dspring.output.ansi.enabled=always',
    '-noverify',
    '-XX:TieredStopAtLevel=1',
    '-Xmx1024m')
  sourceResources sourceSets.main
  String springProfilesActive = 'spring.profiles.active'
  systemProperty springProfilesActive, System.getProperty(springProfilesActive)
}
